# RPC Service
The **RPC Web Service** Provides a local Web API that interacts with both local OCB instance and the global RPC Chaincode. Three service endpoints are available to clients: Release, Acquire and Dispose.

## Installation
### Prerequisites
* Linux Environment.
* Administrative access to the machine.
* Access to Internet.
* [Node](https://nodejs.org/en/download/) and pm correctly installed (version 8.x or greater)
* Docker and Docker Compose correctly installed and working.
* Clone the repository: `git clone https://github.com/far-edge/DistributedLedger.git && cd roaming-product-context`

### Installation Guide
#### HLF Administrator
* Point to the `chaincode` folder.
*	Deploy the Node.js Chaincode in the **HLF 1.3** Network.
*	Give users, **the digital certificates and a configuration file** in order to access to the Chaincode and Network Installation.
#### User
* Open a Terminal Console on your system. 
*	Point to the `client` folder.
*	Copy the `config-fabric-network.json` given by your HLF administrator under the folder `docker/resources`.
*	Copy the digital certificates given by your HLF administrator, under the `docker/resources/crypto-config` folder.
*	Create the Docker artifact containing the OCB + OCB Proxy with the command:  
    `npm run docker`.
*	Launch the system with the command: `./start.sh`. 



## Usage
<br/>The RPC Service is now available on port `4026` of your environment.
<br/>Furthermore, users are allowed to edit and customize the `start.sh` script if they need to add some instructions to the system during the bootstrap phase.

### The RPC Web Service API

+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Title            | Release                                                                                                                                                                                                                                              |
+==================+======================================================================================================================================================================================================================================================+
| Description      | This call receives the ID of an NGSI entity that currently exists on the local OCB. If successful, it copies the NGSI entity to the global DL as a sealed object, identified by the ID; at the same time, it deletes it from the local OCB.          |
|                  |                                                                                                                                                                                                                                                      |
|                  | Note: the global DL can either contain *no* sealed object with the same ID or a matching sealed object which is *not* in "locked" state (see Acquire); in the latter case, the old sealed object is logically deleted and replaced with the new one. |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| URL              | /rpc/v1/entities                                                                                                                                                                                                                                     |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Method           | POST                                                                                                                                                                                                                                                 |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| URL Params       | id=\[string\]                                                                                                                                                                                                                                        |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Success Response | Code: 201 CREATED (a new sealed object was created)                                                                                                                                                                                                  |
|                  |                                                                                                                                                                                                                                                      |
|                  | Code: 204 NO CONTENT (an existing sealed object was released)                                                                                                                                                                                        |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Error Responses  | Code: 400 BAD REQUEST (invalid format of request)                                                                                                                                                                                                    |
|                  |                                                                                                                                                                                                                                                      |
|                  | Code: 409 CONFLICT (any of the following:                                                                                                                                                                                                            |
|                  |                                                                                                                                                                                                                                                      |
|                  | > no matching entity exists on OCB                                                                                                                                                                                                                   |
|                  | >                                                                                                                                                                                                                                                    |
|                  | > a matching sealed object in "locked" state exists in the DL)                                                                                                                                                                                       |
|                  |                                                                                                                                                                                                                                                      |
|                  | Code: 500 INTERNAL SERVER ERROR (any other error)                                                                                                                                                                                                    |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Title            | Acquire                                                                                                                                                                                                                                          |
+==================+==================================================================================================================================================================================================================================================+
| Description      | This call receives the ID of a sealed object that currently exists on the global DL. If successful, it copies the sealed object as an NGSI entity with the same ID on the local OCB; at the same time, it marks it as "locked" on the global DL. |
|                  |                                                                                                                                                                                                                                                  |
|                  | Note: the sealed object on the global DL *cannot* be already in "locked" state.                                                                                                                                                                  |
+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| URL              | /rpc/v1/entities                                                                                                                                                                                                                                 |
+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Method           | PUT                                                                                                                                                                                                                                              |
+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| URL Params       | id=\[string\]                                                                                                                                                                                                                                    |
+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Success Response | Code: 204 NO CONTENT                                                                                                                                                                                                                             |
+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Error Responses  | Code: 400 BAD REQUEST (invalid format of request)                                                                                                                                                                                                |
|                  |                                                                                                                                                                                                                                                  |
|                  | Code: 409 CONFLICT (any of the following:                                                                                                                                                                                                        |
|                  |                                                                                                                                                                                                                                                  |
|                  | > no matching sealed object exists on the DL                                                                                                                                                                                                     |
|                  | >                                                                                                                                                                                                                                                |
|                  | > the matching sealed object on the DL is in "locked" state                                                                                                                                                                                      |
|                  | >                                                                                                                                                                                                                                                |
|                  | > a matching entity already exists on OCB)                                                                                                                                                                                                       |
|                  |                                                                                                                                                                                                                                                  |
|                  | Code: 500 INTERNAL SERVER ERROR (any other error)                                                                                                                                                                                                |
+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Title            | Dispose                                                                                                                                                                                                                                                    |
+==================+============================================================================================================================================================================================================================================================+
| Description      | This call receives the ID of a sealed object that currently exists on the global DL. If successful, it performs a logical deletion (i.e., the sealed object disappears from the global DL to all practical effects, but is maintained in the history log). |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| URL              | /rpc/v1/entities/{id}                                                                                                                                                                                                                                      |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Method           | DELETE                                                                                                                                                                                                                                                     |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| URL Params       |                                                                                                                                                                                                                                                            |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Success Response | Code: 204 NO CONTENT                                                                                                                                                                                                                                       |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Error Responses  | Code: 400 BAD REQUEST (invalid format of request)                                                                                                                                                                                                          |
|                  |                                                                                                                                                                                                                                                            |
|                  | Code: 409 CONFLICT (no matching sealed object exists on the DL)                                                                                                                                                                                            |
|                  |                                                                                                                                                                                                                                                            |
|                  | Code: 500 INTERNAL SERVER ERROR (any other error)                                                                                                                                                                                                          |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
